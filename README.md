### Lesson 11 - Thursday 12/1/22

* This week, we continue our study of unbounded event count distributions.
* Let's begin by reading in this week's dataset.
* Once we have the data in memory, let's briefly explore.

```r
df <- read.csv(file="lesson11.csv",sep=",",header=T)
attach(df)


n <- length(y)
table(y)
mean(y)
var(y)

par(mfrow=c(2,2))
barplot(table(y),ylim=c(0,800),
  xlab="Value of y",
  ylab="Frequency distribution of y")
hist(x,prob=T)
lines(density(x),lty=1,lwd=2)
boxplot(x~z)
```

* Here is the output:

```Rout
> df <- read.csv(file="lesson11.csv",sep=",",header=T)
> attach(df)
> 
> n <- length(y)
> table(y)
y
  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14 
790 258 121  80  71  66  43  46  32  35  31  24  23  20  10 
 15  16  17  18  19  20  21  22  23  24  25  26  27  28  29 
 15   7   8   9   9  11   5   5   4   5   4   2   2   5   1 
 33  36  37  41  42  46  57  63 
  1   1   1   1   1   1   1   1 
> mean(y)
[1] 3.393143
> var(y)
[1] 35.28274
> 
> par(mfrow=c(2,2))
> barplot(table(y),ylim=c(0,800),
+   xlab="Value of y",
+   ylab="Frequency distribution of y")
> hist(x,prob=T)
> lines(density(x),lty=1,lwd=2)
> boxplot(x~z)
> 
```

* Here are 3 plots generated by the above code:

<p align="left">
<img src="/gfiles/eda-event.png" width="600px">
</p>

* Now, let's consider a linear model

```R
summary(lm(y~1+x+z+x*z,data=df))
mean(x)
median(x)

lm.pz0 <- -0.9651+0.2937*5.030664+rnorm(n=100000,mean=0,sd=3.974)
mean(lm.pz0)

lm.pz1 <- -0.9651+0.2937*5.030664-23.1395*1+4.9761*5.030664*1+rnorm(n=100000,mean=0,sd=3.974)
mean(lm.pz1)
boxplot(lm.pz0,lm.pz1)
```

* Here is the output:

```Rout
> summary(lm(y~1+x+z+x*z,data=df))

Call:
lm(formula = y ~ 1 + x + z + x * z, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-10.261  -0.855  -0.166   0.542  50.564 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  -0.9651     0.6775  -1.424   0.1545    
x             0.2937     0.1559   1.884   0.0598 .  
z           -23.1395     1.1703 -19.773   <2e-16 ***
x:z           4.9761     0.2250  22.119   <2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 3.974 on 1746 degrees of freedom
Multiple R-squared:  0.5532,	Adjusted R-squared:  0.5525 
F-statistic: 720.7 on 3 and 1746 DF,  p-value: < 2.2e-16

> mean(x)
[1] 5.030664
> median(x)
[1] 5.018539
> 
> lm.pz0 <- -0.9651+0.2937*5.030664+rnorm(n=100000,mean=0,sd=3.974)
> mean(lm.pz0)
[1] 0.5212834
> 
> lm.pz1 <- -0.9651+0.2937*5.030664-23.1395*1+4.9761*5.030664*1+rnorm(n=100000,mean=0,sd=3.974)
> mean(lm.pz1)
[1] 2.40437
> boxplot(lm.pz0,lm.pz1)
> 
```

and the boxplot is:

<p align="left">
<img src="/gfiles/lm-boxplot.png" width="600px">
</p>

* Next, we estimate a Poisson regression model with outcome variable, *y*, and independent variables, *x* and *z*:

```R
prm <- glm(y~1+x+z+x*z,family="poisson")
summary(prm)
logLik(prm)
aic <- logLik(prm)-4
aic
bic <- logLik(prm)-4/2*log(n)
bic
```

* Here are the results:

```Rout
> prm <- glm(y~1+x+z+x*z,family="poisson")
> summary(prm)

Call:
glm(formula = y ~ 1 + x + z + x * z, family = "poisson")

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.2682  -0.8678  -0.4798   0.4000   8.7653  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept) -5.38010    0.34173 -15.744  < 2e-16 ***
x            0.89293    0.06705  13.318  < 2e-16 ***
z            0.23987    0.37467   0.640 0.522037    
x:z          0.25111    0.07121   3.526 0.000421 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 12675  on 1749  degrees of freedom
Residual deviance:  3077  on 1746  degrees of freedom
AIC: 6170.4

Number of Fisher Scoring iterations: 6

> logLik(prm)
'log Lik.' -3081.196 (df=4)
> aic <- logLik(prm)-4
> aic
'log Lik.' -3085.196 (df=4)
> bic <- logLik(prm)-4/2*log(n)
> bic
'log Lik.' -3096.131 (df=4)
> 
```

* Now, we turn to the geometric model:

```R
library(MASS)
grm <- glm(y~1+x+z+x*z,family=negative.binomial(theta = 1))
summary(grm)
logLik(grm)
aic <- logLik(grm)-4
aic
bic <- logLik(grm)-4/2*log(n)
bic
```

* Here are the results:

```Rout
> library(MASS)
> grm <- glm(y~1+x+z+x*z,family=negative.binomial(theta = 1))
> summary(grm)

Call:
glm(formula = y ~ 1 + x + z + x * z, family = negative.binomial(theta = 1))

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9650  -0.6460  -0.4193   0.1686   2.3955  

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) -5.36133    0.32919 -16.286  < 2e-16 ***
x            0.88897    0.06750  13.169  < 2e-16 ***
z            0.35433    0.41489   0.854  0.39321    
x:z          0.23336    0.07941   2.938  0.00334 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for Negative Binomial(1) family taken to be 0.6529988)

    Null deviance: 3480.94  on 1749  degrees of freedom
Residual deviance:  930.55  on 1746  degrees of freedom
AIC: 5705.2

Number of Fisher Scoring iterations: 4

> logLik(grm)
'log Lik.' -2848.603 (df=4)
> aic <- logLik(grm)-4
> aic
'log Lik.' -2852.603 (df=4)
> bic <- logLik(grm)-4/2*log(n)
> bic
'log Lik.' -2863.538 (df=4)
> 
```

* And, finally, we consider the negative binomial model:

```R
nbrm <- glm.nb(y~1+x+z+x*z)
summary(nbrm)
logLik(nbrm)
aic <- logLik(nbrm)-5
aic
bic <- logLik(nbrm)-5/2*log(n)
bic
```

* Here are those results:

```R
> nbrm <- glm.nb(y~1+x+z+x*z)
> summary(nbrm)

Call:
glm.nb(formula = y ~ 1 + x + z + x * z, init.theta = 3.725822978, 
    link = log)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.6583  -0.7557  -0.4531   0.2630   3.1433  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept) -5.36962    0.36317 -14.785  < 2e-16 ***
x            0.89072    0.07247  12.291  < 2e-16 ***
z            0.30852    0.42412   0.727  0.46696    
x:z          0.24049    0.08069   2.980  0.00288 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for Negative Binomial(3.7258) family taken to be 1)

    Null deviance: 6679.5  on 1749  degrees of freedom
Residual deviance: 1518.0  on 1746  degrees of freedom
AIC: 5413.8

Number of Fisher Scoring iterations: 1


              Theta:  3.726 
          Std. Err.:  0.305 

 2 x log-likelihood:  -5403.779 
> logLik(nbrm)
'log Lik.' -2701.89 (df=5)
> aic <- logLik(nbrm)-5
> aic
'log Lik.' -2706.89 (df=5)
> bic <- logLik(nbrm)-5/2*log(n)
> bic
'log Lik.' -2720.558 (df=5)
> 
```

* Note there are several parameterizations of the geometric and negative binomial models. 
* We now turn to a fit assessment.
* First, we have to do some pre-processing. We begin with the Poisson model:

```R
# save parameter estimates

p.a <- coef(prm)[1]
p.b <- coef(prm)[2]
p.c <- coef(prm)[3]
p.d <- coef(prm)[4]
p.lambda <- exp(p.a+p.b*x+p.c*z+p.d*x*z)

# look at the probability distribution

pm0 <- vector()
pm1 <- vector()
pm2 <- vector()
pm3 <- vector()
pm4 <- vector()
pm5 <- vector()
pm6 <- vector()
pm7 <- vector()
pm8 <- vector()
pm9 <- vector()

pm10 <- vector()
pm11 <- vector()
pm12 <- vector()
pm13 <- vector()
pm14 <- vector()
pm15 <- vector()
pm16 <- vector()
pm17 <- vector()
pm18 <- vector()
pm19 <- vector()

pm20 <- vector()
pm21 <- vector()
pm22 <- vector()
pm23 <- vector()
pm24 <- vector()
pm25 <- vector()
pm26 <- vector()
pm27 <- vector()
pm28 <- vector()
pm29 <- vector()
pm30 <- vector()
pm31 <- vector()

for(i in 1:n){

  k <- 0
  pm0[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 1
  pm1[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 2
  pm2[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 3
  pm3[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 4
  pm4[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 5
  pm5[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 6
  pm6[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 7
  pm7[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 8
  pm8[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 9
  pm9[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 10
  pm10[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 11
  pm11[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 12
  pm12[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 13
  pm13[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 14
  pm14[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 15
  pm15[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 16
  pm16[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 17
  pm17[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 18
  pm18[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 19
  pm19[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 20
  pm20[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 21
  pm21[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 22
  pm22[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 23
  pm23[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 24
  pm24[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 25
  pm25[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 26
  pm26[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 27
  pm27[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 28
  pm28[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 29
  pm29[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

  k <- 30
  pm30[i] <- exp(-p.lambda[i])*p.lambda[i]^k/factorial(k)

}

pmvec <- c(sum(pm0),sum(pm1),sum(pm2),sum(pm3),sum(pm4),
  sum(pm5),sum(pm6),sum(pm7),sum(pm8),sum(pm9),sum(pm10),
  sum(pm11),sum(pm12),sum(pm13),sum(pm14),sum(pm15),
  sum(pm16),sum(pm17),sum(pm18),sum(pm19),sum(pm20),
  sum(pm21),sum(pm22),sum(pm23),sum(pm24),sum(pm25),
  sum(pm26),sum(pm27),sum(pm28),sum(pm29),sum(pm30))
length(pmvec)

pmvec[32] <- 1750-sum(pmvec[1:31])
sum(pmvec)
```

* Now, we turn to the geometric distribution:

```R
# save parameter estimates

g.a <- coef(grm)[1]
g.b <- coef(grm)[2]
g.c <- coef(grm)[3]
g.d <- coef(grm)[4]
g.lambda <- exp(g.a+g.b*x+g.c*z+g.d*x*z)
theta <- 1

# look at the probability distribution

gm0 <- vector()
gm1 <- vector()
gm2 <- vector()
gm3 <- vector()
gm4 <- vector()
gm5 <- vector()
gm6 <- vector()
gm7 <- vector()
gm8 <- vector()
gm9 <- vector()

gm10 <- vector()
gm11 <- vector()
gm12 <- vector()
gm13 <- vector()
gm14 <- vector()
gm15 <- vector()
gm16 <- vector()
gm17 <- vector()
gm18 <- vector()
gm19 <- vector()

gm20 <- vector()
gm21 <- vector()
gm22 <- vector()
gm23 <- vector()
gm24 <- vector()
gm25 <- vector()
gm26 <- vector()
gm27 <- vector()
gm28 <- vector()
gm29 <- vector()
gm30 <- vector()
gm31 <- vector()

for(i in 1:n){

  k <- 0
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm0[i] <- pt3*pt6

  k <- 1
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm1[i] <- pt3*pt6

  k <- 2
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm2[i] <- pt3*pt6

  k <- 3
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm3[i] <- pt3*pt6

  k <- 4
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm4[i] <- pt3*pt6

  k <- 5
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm5[i] <- pt3*pt6

  k <- 6
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm6[i] <- pt3*pt6

  k <- 7
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm7[i] <- pt3*pt6

  k <- 8
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm8[i] <- pt3*pt6

  k <- 9
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm9[i] <- pt3*pt6

  k <- 10
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm10[i] <- pt3*pt6

  k <- 11
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm11[i] <- pt3*pt6

  k <- 12
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm12[i] <- pt3*pt6

  k <- 13
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm13[i] <- pt3*pt6

  k <- 14
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm14[i] <- pt3*pt6

  k <- 15
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm15[i] <- pt3*pt6

  k <- 16
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm16[i] <- pt3*pt6

  k <- 17
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm17[i] <- pt3*pt6

  k <- 18
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm18[i] <- pt3*pt6

  k <- 19
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm19[i] <- pt3*pt6

  k <- 20
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm20[i] <- pt3*pt6

  k <- 21
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm21[i] <- pt3*pt6

  k <- 22
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm22[i] <- pt3*pt6

  k <- 23
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm23[i] <- pt3*pt6

  k <- 24
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm24[i] <- pt3*pt6

  k <- 25
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm25[i] <- pt3*pt6

  k <- 26
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm26[i] <- pt3*pt6

  k <- 27
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm27[i] <- pt3*pt6

  k <- 28
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm28[i] <- pt3*pt6

  k <- 29
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm29[i] <- pt3*pt6

  k <- 30
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (g.lambda[i]^k)*(theta^theta)
  pt5 <- (g.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  gm30[i] <- pt3*pt6

}

gmvec <- c(sum(gm0),sum(gm1),sum(gm2),sum(gm3),sum(gm4),
  sum(gm5),sum(gm6),sum(gm7),sum(gm8),sum(gm9),sum(gm10),
  sum(gm11),sum(gm12),sum(gm13),sum(gm14),sum(gm15),
  sum(gm16),sum(gm17),sum(gm18),sum(gm19),sum(gm20),
  sum(gm21),sum(gm22),sum(gm23),sum(gm24),sum(gm25),
  sum(gm26),sum(gm27),sum(gm28),sum(gm29),sum(gm30))
length(gmvec)

gmvec[32] <- 1750-sum(gmvec[1:31])
sum(gmvec)
```

* And, next we turn to the negative binomial model:

```R
nb.a <- coef(nbrm)[1]
nb.b <- coef(nbrm)[2]
nb.c <- coef(nbrm)[3]
nb.d <- coef(nbrm)[4]
theta <- nbrm$theta
nb.lambda <- exp(nb.a+nb.b*x+nb.c*z+nb.d*x*z)


# look at the probability distribution

nbm0 <- vector()
nbm1 <- vector()
nbm2 <- vector()
nbm3 <- vector()
nbm4 <- vector()
nbm5 <- vector()
nbm6 <- vector()
nbm7 <- vector()
nbm8 <- vector()
nbm9 <- vector()

nbm10 <- vector()
nbm11 <- vector()
nbm12 <- vector()
nbm13 <- vector()
nbm14 <- vector()
nbm15 <- vector()
nbm16 <- vector()
nbm17 <- vector()
nbm18 <- vector()
nbm19 <- vector()

nbm20 <- vector()
nbm21 <- vector()
nbm22 <- vector()
nbm23 <- vector()
nbm24 <- vector()
nbm25 <- vector()
nbm26 <- vector()
nbm27 <- vector()
nbm28 <- vector()
nbm29 <- vector()
nbm30 <- vector()
nbm31 <- vector()

for(i in 1:n){

  k <- 0
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm0[i] <- pt3*pt6

  k <- 1
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm1[i] <- pt3*pt6

  k <- 2
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm2[i] <- pt3*pt6

  k <- 3
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm3[i] <- pt3*pt6

  k <- 4
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm4[i] <- pt3*pt6

  k <- 5
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm5[i] <- pt3*pt6

  k <- 6
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm6[i] <- pt3*pt6

  k <- 7
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm7[i] <- pt3*pt6

  k <- 8
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm8[i] <- pt3*pt6

  k <- 9
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm9[i] <- pt3*pt6

  k <- 10
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm10[i] <- pt3*pt6

  k <- 11
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm11[i] <- pt3*pt6

  k <- 12
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm12[i] <- pt3*pt6

  k <- 13
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm13[i] <- pt3*pt6

  k <- 14
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm14[i] <- pt3*pt6

  k <- 15
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm15[i] <- pt3*pt6

  k <- 16
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm16[i] <- pt3*pt6

  k <- 17
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm17[i] <- pt3*pt6

  k <- 18
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm18[i] <- pt3*pt6

  k <- 19
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm19[i] <- pt3*pt6

  k <- 20
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm20[i] <- pt3*pt6

  k <- 21
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm21[i] <- pt3*pt6

  k <- 22
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm22[i] <- pt3*pt6

  k <- 23
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm23[i] <- pt3*pt6

  k <- 24
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm24[i] <- pt3*pt6

  k <- 25
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm25[i] <- pt3*pt6

  k <- 26
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm26[i] <- pt3*pt6

  k <- 27
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm27[i] <- pt3*pt6

  k <- 28
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm28[i] <- pt3*pt6

  k <- 29
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm29[i] <- pt3*pt6

  k <- 30
  pt1 <- gamma(k+theta)
  pt2 <- gamma(theta)*factorial(k)
  pt3 <- pt1/pt2
  pt4 <- (nb.lambda[i]^k)*(theta^theta)
  pt5 <- (nb.lambda[i]+theta)^(k+theta)
  pt6 <- pt4/pt5
  nbm30[i] <- pt3*pt6

}

nbmvec <- c(sum(nbm0),sum(nbm1),sum(nbm2),sum(nbm3),sum(nbm4),
  sum(nbm5),sum(nbm6),sum(nbm7),sum(nbm8),sum(nbm9),sum(nbm10),
  sum(nbm11),sum(nbm12),sum(nbm13),sum(nbm14),sum(nbm15),
  sum(nbm16),sum(nbm17),sum(nbm18),sum(nbm19),sum(nbm20),
  sum(nbm21),sum(nbm22),sum(nbm23),sum(nbm24),sum(nbm25),
  sum(nbm26),sum(nbm27),sum(nbm28),sum(nbm29),sum(nbm30))
length(nbmvec)

nbmvec[32] <- 1750-sum(nbmvec[1:31])
sum(nbmvec)
```

* With these results in hand, we can now set up a goodness of fit table:

```R
xvec <- seq(from=0,to=31,by=1)
xvec

yvec <- c(790,258,121,80,71,66,43,46,32,35,31,24,23,20,10,15,7,
  8,9,9,11,5,5,4,5,4,2,2,5,1,0,8)
length(yvec)
sum(yvec)

data.frame(xvec,yvec,pmvec,gmvec,nbmvec)
```

which looks like this:

```Rout
> xvec <- seq(from=0,to=31,by=1)
> xvec
 [1]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18
[20] 19 20 21 22 23 24 25 26 27 28 29 30 31
> 
> yvec <- c(790,258,121,80,71,66,43,46,32,35,31,24,23,20,10,15,7,
+   8,9,9,11,5,5,4,5,4,2,2,5,1,0,8)
> length(yvec)
[1] 32
> sum(yvec)
[1] 1750
> 
> data.frame(xvec,yvec,pmvec,gmvec,nbmvec)
   xvec yvec        pmvec      gmvec     nbmvec
1     0  790 761.98200769 897.605956 794.565653
2     1  258 249.07047473 248.970212 252.440226
3     2  121 116.73799839 119.444213 123.141695
4     3   80  81.16111153  77.258056  85.367032
5     4   71  66.14118556  57.042996  67.817264
6     5   66  57.27758942  44.886251  56.696653
7     6   43  51.13210948  36.608818  48.472161
8     7   46  46.47948320  30.551516  41.904999
9     8   32  42.67122896  25.911071  36.441252
10    9   35  39.30476641  22.242129  31.787044
11   10   31  36.13575755  19.273497  27.766226
12   11   24  33.02114666  16.828579  24.263095
13   12   23  29.87728052  14.786492  21.195936
14   13   20  26.66206630  13.061239  18.503465
15   14   10  23.37473009  11.589736  16.137361
16   15   15  20.05814502  10.324535  14.057935
17   16    7  16.79285763   9.229193  12.231557
18   17    8  13.68095368   8.275227  10.629074
19   18    9  10.82464115   7.440036   9.224838
20   19    9   8.30646698   6.705449   7.996071
21   20   11   6.17641428   6.056690   6.922449
22   21    5   4.44788066   5.481623   5.985798
23   22    5   3.10152585   4.970187   5.169866
24   23    4   2.09416317   4.513979   4.460136
25   24    5   1.36942939   4.105928   3.843666
26   25    4   0.86755914   3.740042   3.308936
27   26    2   0.53267941   3.411219   2.845726
28   27    2   0.31713692   3.115086   2.444981
29   28    5   0.18317642   2.847879   2.098703
30   29    1   0.10270139   2.606342   1.799842
31   30    0   0.05592661   2.387650   1.542197
32   31    8   0.05940581  28.728177   8.938166
> 
```

* We can also add some information to our plot:

```R
# interpret relationship between x, z, and lambda

xs <- seq(from=3,to=7,by=0.1)

zs <- 0
lambda.z0 <- exp(nb.a+nb.b*xs+nb.c*zs+nb.d*xs*zs)

zs <- 1
lambda.z1 <- exp(nb.a+nb.b*xs+nb.c*zs+nb.d*xs*zs)

plot(x=xs,y=lambda.z0,type="l",lty=1,lwd=2,col="red",
  xlab="Range of continuous independent variable, x",
  ylab="Expected value of Lambda | X and Z")
lines(x=xs,y=lambda.z1,type="l",lty=1,lwd=2,col="blue")

data.frame(xs,lambda.z0,lambda.z1)
```

which yields the following results:

```Rout
> # interpret relationship between x, z, and lambda
> 
> xs <- seq(from=3,to=7,by=0.1)
> 
> zs <- 0
> lambda.z0 <- exp(nb.a+nb.b*xs+nb.c*zs+nb.d*xs*zs)
> 
> zs <- 1
> lambda.z1 <- exp(nb.a+nb.b*xs+nb.c*zs+nb.d*xs*zs)
> 
> plot(x=xs,y=lambda.z0,type="l",lty=1,lwd=2,col="red",
+   xlab="Range of continuous independent variable, x",
+   ylab="Expected value of Lambda | X and Z")
> lines(x=xs,y=lambda.z1,type="l",lty=1,lwd=2,col="blue")
> 
> data.frame(xs,lambda.z0,lambda.z1)
    xs  lambda.z0  lambda.z1
1  3.0 0.06737650  0.1887234
2  3.1 0.07365325  0.2113262
3  3.2 0.08051475  0.2366362
4  3.3 0.08801545  0.2649775
5  3.4 0.09621492  0.2967131
6  3.5 0.10517825  0.3322497
7  3.6 0.11497659  0.3720423
8  3.7 0.12568775  0.4166009
9  3.8 0.13739674  0.4664960
10 3.9 0.15019654  0.5223670
11 4.0 0.16418877  0.5849295
12 4.1 0.17948450  0.6549849
13 4.2 0.19620517  0.7334307
14 4.3 0.21448353  0.8212718
15 4.4 0.23446469  0.9196333
16 4.5 0.25630728  1.0297753
17 4.6 0.28018472  1.1531087
18 4.7 0.30628657  1.2912135
19 4.8 0.33482005  1.4458587
20 4.9 0.36601169  1.6190253
21 5.0 0.40010912  1.8129316
22 5.1 0.43738306  2.0300615
23 5.2 0.47812941  2.2731966
24 5.3 0.52267166  2.5454512
25 5.4 0.57136345  2.8503131
26 5.5 0.62459134  3.1916875
27 5.6 0.68277791  3.5739473
28 5.7 0.74638510  4.0019894
29 5.8 0.81591790  4.4812970
30 5.9 0.89192834  5.0180099
31 6.0 0.97501987  5.6190035
32 6.1 1.06585215  6.2919765
33 6.2 1.16514632  7.0455497
34 6.3 1.27369067  7.8893763
35 6.4 1.39234695  8.8342658
36 6.5 1.52205718  9.8923221
37 6.6 1.66385115 11.0770990
38 6.7 1.81885455 12.4037735
39 6.8 1.98829799 13.8893402
40 6.9 2.17352667 15.5528293
41 7.0 2.37601115 17.4155500
> 
```

<p align="left">
<img src="/gfiles/effect-plot.png" width="600px">
</p>

* As a final step, we tabulate the expected distribution of *y* for different values of *x* and *z* based on the negative binomial model. Here is
the R code:

```R
# probability distribution of y|x=?,z=?

xq <- 3
zq <- 0
lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)

pvec <- vector()
k <- vector()

for(i in 1:31){
  k[i] <- i-1
  pt1 <- gamma(k[i]+theta)
  pt2 <- gamma(theta)*factorial(k[i])
  pt3 <- pt1/pt2
  pt4 <- (lmb^k[i])*(theta^theta)
  pt5 <- (lmb+theta)^(k[i]+theta)
  pt6 <- pt4/pt5
  pvec[i] <- pt3*pt6
}

sum(pvec)
data.frame(k,round(pvec,5))

xq <- 5
zq <- 0
lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)

pvec <- vector()
k <- vector()

for(i in 1:31){
  k[i] <- i-1
  pt1 <- gamma(k[i]+theta)
  pt2 <- gamma(theta)*factorial(k[i])
  pt3 <- pt1/pt2
  pt4 <- (lmb^k[i])*(theta^theta)
  pt5 <- (lmb+theta)^(k[i]+theta)
  pt6 <- pt4/pt5
  pvec[i] <- pt3*pt6
}

sum(pvec)
data.frame(k,round(pvec,5))

xq <- 7
zq <- 0
lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)

pvec <- vector()
k <- vector()

for(i in 1:31){
  k[i] <- i-1
  pt1 <- gamma(k[i]+theta)
  pt2 <- gamma(theta)*factorial(k[i])
  pt3 <- pt1/pt2
  pt4 <- (lmb^k[i])*(theta^theta)
  pt5 <- (lmb+theta)^(k[i]+theta)
  pt6 <- pt4/pt5
  pvec[i] <- pt3*pt6
}

sum(pvec)
data.frame(k,round(pvec,5))

xq <- 3
zq <- 1
lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)

pvec <- vector()
k <- vector()

for(i in 1:31){
  k[i] <- i-1
  pt1 <- gamma(k[i]+theta)
  pt2 <- gamma(theta)*factorial(k[i])
  pt3 <- pt1/pt2
  pt4 <- (lmb^k[i])*(theta^theta)
  pt5 <- (lmb+theta)^(k[i]+theta)
  pt6 <- pt4/pt5
  pvec[i] <- pt3*pt6
}

sum(pvec)
data.frame(k,round(pvec,5))

xq <- 5
zq <- 1
lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)

pvec <- vector()
k <- vector()

for(i in 1:31){
  k[i] <- i-1
  pt1 <- gamma(k[i]+theta)
  pt2 <- gamma(theta)*factorial(k[i])
  pt3 <- pt1/pt2
  pt4 <- (lmb^k[i])*(theta^theta)
  pt5 <- (lmb+theta)^(k[i]+theta)
  pt6 <- pt4/pt5
  pvec[i] <- pt3*pt6
}

sum(pvec)
data.frame(k,round(pvec,5))

xq <- 7
zq <- 1
lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)

pvec <- vector()
k <- vector()

for(i in 1:31){
  k[i] <- i-1
  pt1 <- gamma(k[i]+theta)
  pt2 <- gamma(theta)*factorial(k[i])
  pt3 <- pt1/pt2
  pt4 <- (lmb^k[i])*(theta^theta)
  pt5 <- (lmb+theta)^(k[i]+theta)
  pt6 <- pt4/pt5
  pvec[i] <- pt3*pt6
}

sum(pvec)
data.frame(k,round(pvec,5))
```

* And, these are the results:

```Rout
> # probability distribution of y|x=?,z=?
> 
> xq <- 3
> zq <- 0
> lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)
> 
> pvec <- vector()
> k <- vector()
> 
> for(i in 1:31){
+   k[i] <- i-1
+   pt1 <- gamma(k[i]+theta)
+   pt2 <- gamma(theta)*factorial(k[i])
+   pt3 <- pt1/pt2
+   pt4 <- (lmb^k[i])*(theta^theta)
+   pt5 <- (lmb+theta)^(k[i]+theta)
+   pt6 <- pt4/pt5
+   pvec[i] <- pt3*pt6
+ }
> 
> sum(pvec)
[1] 1
> data.frame(k,round(pvec,5))
    k round.pvec..5.
1   0        0.93541
2   1        0.06190
3   2        0.00260
4   3        0.00009
5   4        0.00000
6   5        0.00000
7   6        0.00000
8   7        0.00000
9   8        0.00000
10  9        0.00000
11 10        0.00000
12 11        0.00000
13 12        0.00000
14 13        0.00000
15 14        0.00000
16 15        0.00000
17 16        0.00000
18 17        0.00000
19 18        0.00000
20 19        0.00000
21 20        0.00000
22 21        0.00000
23 22        0.00000
24 23        0.00000
25 24        0.00000
26 25        0.00000
27 26        0.00000
28 27        0.00000
29 28        0.00000
30 29        0.00000
31 30        0.00000
> 
> xq <- 5
> zq <- 0
> lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)
> 
> pvec <- vector()
> k <- vector()
> 
> for(i in 1:31){
+   k[i] <- i-1
+   pt1 <- gamma(k[i]+theta)
+   pt2 <- gamma(theta)*factorial(k[i])
+   pt3 <- pt1/pt2
+   pt4 <- (lmb^k[i])*(theta^theta)
+   pt5 <- (lmb+theta)^(k[i]+theta)
+   pt6 <- pt4/pt5
+   pvec[i] <- pt3*pt6
+ }
> 
> sum(pvec)
[1] 1
> data.frame(k,round(pvec,5))
    k round.pvec..5.
1   0        0.68383
2   1        0.24707
3   2        0.05661
4   3        0.01048
5   4        0.00171
6   5        0.00026
7   6        0.00004
8   7        0.00000
9   8        0.00000
10  9        0.00000
11 10        0.00000
12 11        0.00000
13 12        0.00000
14 13        0.00000
15 14        0.00000
16 15        0.00000
17 16        0.00000
18 17        0.00000
19 18        0.00000
20 19        0.00000
21 20        0.00000
22 21        0.00000
23 22        0.00000
24 23        0.00000
25 24        0.00000
26 25        0.00000
27 26        0.00000
28 27        0.00000
29 28        0.00000
30 29        0.00000
31 30        0.00000
> 
> xq <- 7
> zq <- 0
> lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)
> 
> pvec <- vector()
> k <- vector()
> 
> for(i in 1:31){
+   k[i] <- i-1
+   pt1 <- gamma(k[i]+theta)
+   pt2 <- gamma(theta)*factorial(k[i])
+   pt3 <- pt1/pt2
+   pt4 <- (lmb^k[i])*(theta^theta)
+   pt5 <- (lmb+theta)^(k[i]+theta)
+   pt6 <- pt4/pt5
+   pvec[i] <- pt3*pt6
+ }
> 
> sum(pvec)
[1] 1
> data.frame(k,round(pvec,5))
    k round.pvec..5.
1   0        0.15914
2   1        0.23089
3   2        0.21244
4   3        0.15788
5   4        0.10337
6   5        0.06220
7   6        0.03522
8   7        0.01906
9   8        0.00995
10  9        0.00505
11 10        0.00250
12 11        0.00122
13 12        0.00058
14 13        0.00027
15 14        0.00013
16 15        0.00006
17 16        0.00003
18 17        0.00001
19 18        0.00001
20 19        0.00000
21 20        0.00000
22 21        0.00000
23 22        0.00000
24 23        0.00000
25 24        0.00000
26 25        0.00000
27 26        0.00000
28 27        0.00000
29 28        0.00000
30 29        0.00000
31 30        0.00000
> 
> xq <- 3
> zq <- 1
> lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)
> 
> pvec <- vector()
> k <- vector()
> 
> for(i in 1:31){
+   k[i] <- i-1
+   pt1 <- gamma(k[i]+theta)
+   pt2 <- gamma(theta)*factorial(k[i])
+   pt3 <- pt1/pt2
+   pt4 <- (lmb^k[i])*(theta^theta)
+   pt5 <- (lmb+theta)^(k[i]+theta)
+   pt6 <- pt4/pt5
+   pvec[i] <- pt3*pt6
+ }
> 
> sum(pvec)
[1] 1
> data.frame(k,round(pvec,5))
    k round.pvec..5.
1   0        0.83185
2   1        0.14942
3   2        0.01702
4   3        0.00157
5   4        0.00013
6   5        0.00001
7   6        0.00000
8   7        0.00000
9   8        0.00000
10  9        0.00000
11 10        0.00000
12 11        0.00000
13 12        0.00000
14 13        0.00000
15 14        0.00000
16 15        0.00000
17 16        0.00000
18 17        0.00000
19 18        0.00000
20 19        0.00000
21 20        0.00000
22 21        0.00000
23 22        0.00000
24 23        0.00000
25 24        0.00000
26 25        0.00000
27 26        0.00000
28 27        0.00000
29 28        0.00000
30 29        0.00000
31 30        0.00000
> 
> xq <- 5
> zq <- 1
> lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)
> 
> pvec <- vector()
> k <- vector()
> 
> for(i in 1:31){
+   k[i] <- i-1
+   pt1 <- gamma(k[i]+theta)
+   pt2 <- gamma(theta)*factorial(k[i])
+   pt3 <- pt1/pt2
+   pt4 <- (lmb^k[i])*(theta^theta)
+   pt5 <- (lmb+theta)^(k[i]+theta)
+   pt6 <- pt4/pt5
+   pvec[i] <- pt3*pt6
+ }
> 
> sum(pvec)
[1] 1
> data.frame(k,round(pvec,5))
    k round.pvec..5.
1   0        0.22827
2   1        0.27838
3   2        0.21531
4   3        0.13451
5   4        0.07403
6   5        0.03744
7   6        0.01782
8   7        0.00811
9   8        0.00356
10  9        0.00152
11 10        0.00063
12 11        0.00026
13 12        0.00010
14 13        0.00004
15 14        0.00002
16 15        0.00001
17 16        0.00000
18 17        0.00000
19 18        0.00000
20 19        0.00000
21 20        0.00000
22 21        0.00000
23 22        0.00000
24 23        0.00000
25 24        0.00000
26 25        0.00000
27 26        0.00000
28 27        0.00000
29 28        0.00000
30 29        0.00000
31 30        0.00000
> 
> xq <- 7
> zq <- 1
> lmb <- exp(nb.a+nb.b*xq+nb.c*zq+nb.d*xq*zq)
> 
> pvec <- vector()
> k <- vector()
> 
> for(i in 1:31){
+   k[i] <- i-1
+   pt1 <- gamma(k[i]+theta)
+   pt2 <- gamma(theta)*factorial(k[i])
+   pt3 <- pt1/pt2
+   pt4 <- (lmb^k[i])*(theta^theta)
+   pt5 <- (lmb+theta)^(k[i]+theta)
+   pt6 <- pt4/pt5
+   pvec[i] <- pt3*pt6
+ }
> 
> sum(pvec)
[1] 0.8969508
> data.frame(k,round(pvec,5))
    k round.pvec..5.
1   0        0.00155
2   1        0.00477
3   2        0.00928
4   3        0.01458
5   4        0.02020
6   5        0.02571
7   6        0.03080
8   7        0.03525
9   8        0.03894
10  9        0.04179
11 10        0.04381
12 11        0.04503
13 12        0.04552
14 13        0.04536
15 14        0.04464
16 15        0.04346
17 16        0.04190
18 17        0.04005
19 18        0.03799
20 19        0.03578
21 20        0.03349
22 21        0.03117
23 22        0.02886
24 23        0.02659
25 24        0.02439
26 25        0.02228
27 26        0.02028
28 27        0.01839
29 28        0.01663
30 29        0.01498
31 30        0.01347
> 
```

##### Assignment Due Friday 12/9/22

For this week's assignment, please use the homework dataset to: (1) assess the inadequacy of the linear model; (2) measure overdispersion in the dataset; (3) estimate Poisson, geometric, and negative binomial regressions looking at the relationship between the covariates *x* and *z* and the outcome variable, *y*; (4) study the fit of each of these distributions considering log-likelihood, AIC, and BIC metrics along with a goodness-of-fit assessment; (5) graph the predicted values of the rate parameter, lambda, as a function of the covariates; (6) tabulate the predicted probability distributions of *y* based on reasonable variation in both *x* and *z*; and (7) interpret the relationship between *x*, *z*, and *y*.
